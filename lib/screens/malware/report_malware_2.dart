// malware_report_page.dart
import 'package:file_picker/file_picker.dart';
import 'package:flutter/material.dart';
import 'package:security_alert/custom/CustomDropdown.dart';
import '../../custom/Success_page.dart';
import '../../custom/customTextfield.dart';


class MalwareReportPage2 extends StatefulWidget {
  const MalwareReportPage2({super.key});

  @override
  State<MalwareReportPage2> createState() => _MalwareReportPageState();
}

class _MalwareReportPageState extends State<MalwareReportPage2> {
  PlatformFile? selectedFile;
  final _formKey = GlobalKey<FormState>();

  final TextEditingController _nameController = TextEditingController();
  final TextEditingController _systemAffectedController = TextEditingController();
  String? _selectedSeverity;

  void pickFile() async {
    final result = await FilePicker.platform.pickFiles(
      type: FileType.custom,
      allowedExtensions: ['exe', 'zip'],
      withData: true,
    );

    if (result != null) {
      final file = result.files.first;
      if (file.size > 10 * 1024 * 1024) {
        ScaffoldMessenger.of(context).showSnackBar(
          const SnackBar(content: Text('File size exceeds 10MB')),
        );
        return;
      }
      setState(() {
        selectedFile = file;
      });
    }
  }

  void handleSubmit() {
    if (_formKey.currentState!.validate()) {
      if (selectedFile == null) {
        ScaffoldMessenger.of(context).showSnackBar(
          const SnackBar(content: Text("Please upload a file")),
        );
        return;
      }

      ScaffoldMessenger.of(context).showSnackBar(
        const SnackBar(content: Text("Malware report submitted successfully")),
      );

      setState(() {
        selectedFile = null;
        _nameController.clear();
        _systemAffectedController.clear();
        _selectedSeverity = null;
      });
    }
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: const Text('Report Malware')),
      body: SingleChildScrollView(
        padding: const EdgeInsets.all(16),
        child: Form(
          key: _formKey,
          child: Column(
            crossAxisAlignment: CrossAxisAlignment.start,
            children: [
              const Text("Upload infected files", style: TextStyle(fontWeight: FontWeight.bold)),
              const SizedBox(height: 8),
              GestureDetector(
                onTap: pickFile,
                child: Container(
                  decoration: BoxDecoration(
                    border: Border.all(color: Colors.grey),
                    borderRadius: BorderRadius.circular(8),
                    color: const Color(0xFFEFEFEF),
                  ),
                  padding: const EdgeInsets.all(16),
                  child: Row(
                    children: [
                      const Icon(Icons.add, size: 32),
                      const SizedBox(width: 12),
                      Column(
                        crossAxisAlignment: CrossAxisAlignment.start,
                        children: [
                          const Text("Upload Files", style: TextStyle(fontWeight: FontWeight.bold)),
                          Text("Limit: 10mb", style: TextStyle(fontSize: 12, color: Colors.red.shade700)),
                          const Text("Upload only non-sensitive suspected-infected files",
                              style: TextStyle(fontSize: 10, color: Colors.grey)),
                        ],
                      ),
                    ],
                  ),
                ),
              ),
              if (selectedFile != null)
                Padding(
                  padding: const EdgeInsets.only(top: 8.0),
                  child: Text("Selected: ${selectedFile!.name}", style: const TextStyle(fontSize: 12)),
                ),
              const SizedBox(height: 24),

              const Text("Report malware attack details", style: TextStyle(fontWeight: FontWeight.bold)),
              const SizedBox(height: 16),


              Text("Name",style: TextStyle(fontSize: 14, fontFamily: 'Nunito',fontWeight: FontWeight.bold),),
              SizedBox(height: 8),
              CustomTextField(controller: _nameController,  hintText: "Enter name"),
              const SizedBox(height: 16),

              Text("system Affected",style: TextStyle(fontSize: 14, fontFamily: 'Nunito',fontWeight: FontWeight.bold),),
              SizedBox(height: 8),
              CustomTextField(controller: _systemAffectedController, hintText: "Enter system name"),
              const SizedBox(height: 16),

              CustomDropdown(
                hint: "Select a Scam Type",
                value: _selectedSeverity,
                items: const ['High', 'Medium', 'Low'],
                onChanged: (val) => setState(() => _selectedSeverity = val), label: 'Alert Severity Levels',
              ),

              const SizedBox(height: 24),
              ElevatedButton(
                onPressed: () => Navigator.push(context, MaterialPageRoute(builder: (_) => const ReportSuccess(label: 'Malware Report'))),
                style: ElevatedButton.styleFrom(
                  backgroundColor: const Color(0xFF064FAD),
                  minimumSize: const Size(double.infinity, 48),
                  shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(8)),
                ),
                child: const Text("Submit", style: TextStyle(color: Colors.white)),
              ),
            ],
          ),
        ),
      ),
    );
  }
}
